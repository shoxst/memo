# 文字コード
## 文字コードとは
文字コードはコンピュータ上で文字を扱うために、文字や記号に割り当てられた数値のこと。「文字集合」と「符号化方式」で構成される。

### 文字集合
表現したい文字の集まり。個々の文字に対して、文字集合内での符号位置を割り当て、これをコードポイントという。Unicode、ASCIIコード、JISX0208などがある。

ASCIIコードは、アルファベット、数字、記号、制御コードなどを収録した最も基本的な文字コードで、他の多くの文字コードがASCIIコードの拡張である。ACIIコードにおいては、コードポイントとコンピュータ上で扱う符号が等しい。

ASCII
|  文字  |  コードポイント  |
| ---- | ---- |
|  NUL   |  `00`  |
|  LF  |  `0a`  |
|  A  |  `41`  |


Unicode
|  文字  |  コードポイント  |
| ---- | ---- |
|  A   |  `U+0041`  |
|  あ  |  `U+3042`  |
|  漢  |  `U+6F22`  |


JIS X 0208
|  文字  |  コードポイント  |
| ---- | ---- |
|  A   |  `3-33`  |
|  あ  |  `4-2`  |
|  漢  |  `20-33`  |

### 符号化方式
文字集合を符号化してコンピュータで扱えるようにするエンコード方式。すなわち、ある符号化方式は特定の文字集合に対応している。

|  符号化方式  | 概要 | 対応する文字集合  |
| ---- | ---- | ---- |
|  Shift_JIS  | JIS規格として標準化された日本語を含む様々な文字を収録した符号化方式。CP932はMicrosoftによるShift_JISの独自拡張でWindowsの標準の日本語文字コード、日本語版WindowsではANSIとも呼ばれる。|  JIS X 0208  |
|  EUC-JP | UNIXなどで日本語を表現するときに用いられる符号化方式。|  JIS X 0208, JIS X 0201, JIS X 0212  |
|  UTF-8  | 最もポピュラーな符号化方式。英数は1バイト、日本語は3バイトで表現される。|  Unicode  |
|  UTF-16  | 英数、日本語はすべて2バイトで表現される。| Unicode  |

Shift_JIS
|  文字  |  16進表記  |
| ---- | ---- |
|  A   |  `41`  |
|  あ  |  `82 a0` |
|  漢  |  `8a bf`  |

UTF-8
|  文字  |  16進表記  |
| ---- | ---- |
|  A   |  `41`  |
|  あ  |  `e3 81 82` |
|  漢  |  `e6 bc a2`  |

UTF-16
|  文字  |  16進表記  |
| ---- | ---- |
|  A   |  `00 41`  |
|  あ  |  `30 42` |
|  漢  |  `6f 22`  |

## BOM
### 概要
Unicodeに対応する符号化方式で符号化したテキストの先頭につける数バイトのデータで、このデータをもとにUnicodeで符号化されていることや符号化の種類を判別するのに使用する。Byte Order Mark。

### UTF-8
BOMは`0xEF 0xBB 0xBF`である。BOMなしをUTF-8Nと呼んで区別することがある。

基本的にはBOMなしを使用すればよいはず。ただし、ExcelなどMS製ソフトにテキストファイルを読ませるときにBOMなしUTF-8だと文字化けするので、そうした場合にはBOMをつければよい(例：UTF-8のcsvファイルをExcelで開く)。

VSCodeでBOMのありなしを切り替えるには、

右下のUTF-8 -> エンコード付きで保存 -> UTF-8 with BOM / UTF-8

で設定できる。

### UTF-16
ビックエンディアン or リトルエンディアン、BOMありBOMなしで4通りの符号化方法が存在する。

BOMなしの場合、
- ビッグエンディアンは UTF-16BE
- リトルエンディアンは UTF-16LE

と呼ばれる。一方、BOMありの場合は
- ビックエンディアンはBOMが `0xFE 0xFF`
- リトルエンディアンはBOMが `0xFF 0xFE`

となる、と[Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%90%E3%82%A4%E3%83%88%E9%A0%86%E3%83%9E%E3%83%BC%E3%82%AF)には書いてあるが、メモ帳やVSCodeでは、UTF-16BEまたはUTF-16LEを選ぶことができ、それぞれBOMが付いている。

### まとめ
「あ」一文字のテキストファイルを各符号化方式で保存したときのhexは以下の通り。

|  符号化方式  |  16進表記  |
| ---- | ---- |
|  UTF-8   |  `e3 81 82`  |
|  UTF-8 with BOM  |  `ef bb bf e3 81 82` |
| UTF-16BE  |  `fe ff 30 42`  |
| UTF-16LE  |  `ff fe 42 30`  |

## 注意
### Shift_JISのダメ文字
Shift_JISにおいて、2バイト目が制御記号と重なってしまう文字のこと。`0x5c`の`\`(バックスラッシュ)になるのは「表」「能」など。

|  文字  |  16進表記  |
| ---- | ---- |
|  表  |  `95 5c`  |
|  能  |  `94 5c` |

Shift_JISで保存してUTF-8と認識してしまう(例：gccにShift_JISで渡す)、UTF-8で保存してShift_JISと認識してしまう(例：Visual C++でコンパイル)などといった場合、問題になる。

例えば、Shift_JISで保存した以下のファイルを考える。
```c
#include <stdio.h>
int main(void) {
  // 表
  printf("A");
}
```
コンパイルは通るが、実行しても何も表示されない。これは、「表」の2バイト目がバックスラッシュと認識され、printf()の行もコメントアウトが継続するため。

逆に、UTF-8で保存した
```cpp
// hogeのときだけ可能
if (hoge)
{
  fuga();
}
```
を、Visual C++でコンパイルすると`fuga()`は`hoge`によらず常に実行される。一応、Visual Studioにはソースと実行可能ファイルの文字コードを[UTF-8にするオプション](https://docs.microsoft.com/ja-jp/cpp/build/reference/utf-8-set-source-and-executable-character-sets-to-utf-8?view=msvc-160)があるっぽい。
